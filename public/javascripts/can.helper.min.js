requirejs.config({
    baseUrl: '/dependencies/can-minified'
});

var fiso;
var debug_file;

requirejs(["/dependencies/can-minified/FipCanConfig.js", "Can"], 
    function(CONFIG, Can) {
	
        can = new Can(CONFIG, CONFIG.api_key, CONFIG.api_key_secret);

        // Create FSIO client.
   	    fsio = can.createFsioClient();
        
    }
);

function uploadFile(token, path, file) {
    debug_file = file;
    var object_name = path + "/" + file.name;
    fsio.data.partialUploadInit(token, object_name, function(jqXHR,textStatus) {
        var uploadId = jqXHR.getResponseHeader("upload-id");
            
        // Setup ajax calls when uploading data
        var defaultContentType = $.ajaxSettings.contentType;
        var defaultProcessData = $.ajaxSettings.processData;
        $.ajaxSetup({
            contentType : false,
            processData : false
        });
        Blob.prototype.substring = Blob.prototype.slice;
        file.length = file.size;
        fsio.data.uploadPartially(token, uploadId, file, file.length, function(jqXHR) {
            // alert("Uploaded " + fileName + " with status " + jqXHR.status + " and response text " + jqXHR.responseText);
            $.ajaxSetup({
                contentType : defaultContentType,
                processData : defaultProcessData
            });

            if(jqXHR.status == 204) {
                console.log("Submission successful");
            }
            else {
                console.log("Error while submitting your file");    
            }   
        });
    });
}
