<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="utf-8">
	<title><%= title %></title>
	<link rel='stylesheet' href='/stylesheets/desktop.css' />
	<link rel='stylesheet' href='/stylesheets/notifier-base.css' />
	<link rel='stylesheet' href='/stylesheets/notifier-theme-plastic.css' />
	<link rel='stylesheet' href='//fonts.googleapis.com/css?family=Arvo' />
</head>
<body id="index" class="home">
	
	<header id="banner">
		<div id="header-logo" href="desktop">
			<a href="desktop" id="logo-link">
				<img src="/images/gamified_logo_small.png" alt="Logo" id="logo">
			</a>
		</div>
		<div id="organizerName">
			<% if(user && user.name) { %>
				<span><%= user.name %> logged in. </span><a href="/logout">Log Out</a>.
			<% } else { %>
				<span>You are not logged in.</span>
			<% } %>
		</div>
		<nav>
			<li class="active"><a href="desktop">Home</a></li>
			<!-- Link should be enabled only after successful login to CAN -->
			<li><a id="create-event" href="#">Create Event</a></li>
			<li><a id="manage-event" href="#">Manage Events</a></li>
		</nav>
	</header>
	
	<div id="canLoginLoader" align="center"><h5>Logging into CAN</h5><img src="/images/ajax-loader.gif"></img></div>
	<section id="content" class="body">
	<div id="front-page-holder">
		<div id="demo"></div>
			<div id="welcome">
				<h2>Welcome to Gamified!</h2>
				<p>To take part in an event, visit <a href="/mobile">gami.fi/ed</a> on your mobile device. Just enroll to an event and get going!</p>
				<h4>Creating your own event</h4>
				<p>
					As an event organizer, you can set up an orienteering track for event participants. Along the track, you can assign checkpoints, where participants may perform tasks that you have assigned. This allows for a fun and an interactive way for gathering images and videos from the event.
				</p>
				<p id="note">* Note that you should have already accepted the FIP CAN Facebook app in order for you to have the possibility to crowdsource submissions from your event.</p>
				<p id="fip-can-link">Follow <a href="https://fip.sp.f-secure.com">this link</a> to get it done or follow the instructions <a href="https://developer.f-secure.com/login_guide">here</a> to oder for a new account.</p>
			</div>
		</div>
	</section>

	<footer id="contentinfo" class="body"></footer>
	<script src="/dependencies/jquery-1.7.2.min.js"></script>
	<script src="/dependencies/underscore-1.3.3.min.js"></script>
	<script src="/dependencies/backbone-0.9.2.js"></script>
	<script src="/dependencies/backbone.notifier.js"></script>
	<script src="//api.maps.nokia.com/2.2.3/jsl.js"></script>
	<script src="/javascripts/notifier.js"></script>
	<iframe name="canlogin" src="/organizer/login" style="display:none;"></iframe>

	<script>
		$(document).ready(function(){
			// Off hover capability
			// $('#create-event').unbind('mouseenter mouseleave');
			// $('#manage-event').unbind('mouseenter mouseleave');
			var timeOut = false;
			setInterval(function() {
				timeOut = true;
			},10000);
			// The following is commented out as it would be populated from server directly.
			/* $.getJSON("/api/v2/me", function(json) {
		 		$("#organizerName").text(json.name + " logged in ");
		 		$("#organizerName").append("<a href ='/logout'>Log Out</a>");
		 		$("#organizerName").hide().fadeIn('fast');
			});*/
			var loginAttemptsCounter = 0;
			var loginAttempt = function() { 
                                $.ajax({
                                        url: "https://devapi-fip.sp.f-secure.com:443/OneID/user/2_0_0/scim/v1/Users/current",
                                        headers: {"x-apikey": "l7xx4b2071526ae34e7fb2d33ff02bb82503"},
					xhrFields: { withCredentials: true },
                                        statusCode: {
                                                400: function() {
                                                        loginAttemptsCounter++;
                                                        if(!timeOut){
                                                        	loginAttempt();	
                                                        }               
                                                        if(loginAttemptsCounter == 5000 || timeOut) {
                                                                $("#canLoginLoader>img").fadeOut('fast');
                                                                $("#canLoginLoader>h5").fadeOut('fast');
								// On hower capability 
								// $('#create-event').bind('mouseenter mouseleave');
								// $('#manage-event').bind('mouseenter mouseleave');
								$("#create-event").attr("href", "desktop_create");
								$("#manage-event").attr("href", "desktop_manage");
								displayNotifier("Login to CAN Failed","You must have already granted permissions to the FIP CAN Facebook app. Follow the link below to get it done.")
                                                        }       
                                                },
                                                200: function() {
							$("#create-event").attr("href", "desktop_create");
							$("#manage-event").attr("href", "desktop_manage");
                                                        $("#canLoginLoader>img").fadeOut('fast');
                                                        $("#canLoginLoader>h5").text('Login to CAN was Successful');
							// Hide text after 5 seconds
							setTimeout(function() {
								$("#canLoginLoader>h5").fadeOut('fast');
     							}, 5000); 
                                                }
                                        }
                                });
			}
			loginAttempt();
		});
		function displayNotifier(title_msg, body_msg) {
		        <!-- Display info dialog -->
        		var notifier = new Backbone.Notifier({
        	        	theme: 'plastic',
		                type: 'info',
        	        	dialog: false,
                		modal: true,
		                position: 'center',
	        	        zIndex: 10000,
                		screenOpacity: 0.7,
	        	});
        		notifier.notify({
	                	title: title_msg,
	                	message: body_msg,
        		        hideOnClick: true,
        	        	fadeInMs: 800,
		                fadeOutMs: 800,
        	        	ms: 10000,
	        	});
		}

	</script>
</body>
</html>
