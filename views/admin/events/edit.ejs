<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Edit view</title>
  <script type="text/javascript" src="/dependencies/jquery-1.7.2.min.js"></script> 
  <style>
    .clear { clear: both;}
    .form-label { display: block; width: 75px; float: left; }
    .form-input { display: block; width: 210px; float: left; }
    .form-button-area { text-align: right; padding: 5px 10px;}
    #edit-form { width: 300px; }
  </style>
</head>
<body>
	<h2>Edit an event</h2>
  <form id="edit-form" action="/api/v1/events/<%= event._id %>">
    <div class="form-row">
      <label class="form-label" for="title">Title</label>
      <input class="form-input" id="title" value="<%= event.title %>" type="text" maxlength="128" />
      <div class="clear" />
    </div>
    <div class="form-row">
      <label class="form-label" for="description">Description</label>
      <input class="form-input" id="description" value="<%= event.description %>" type="text" maxlength="512"/>
      <div class="clear" />
    </div>
    <div class="form-row">
      <label class="form-label" for="startTime">Start Time</label>
      <input class="form-input" id="startTime" value="<%= event.startTime %>" type="datetime" />
      <div class="clear" />
    </div>
    <div class="form-row">
      <label class="form-label" for="endTime">End Time</label>
      <input class="form-input" id="endTime" value="<%= event.endTime %>" type="datetime" />
      <div class="clear" />
    </div>
    <h3>location</h3>
    <div class="form-row">
      <label class="form-label" for="longitude">Longitude</label>
      <input class="form-input" id="longitude" value="<%= event.location.longitude %>" type="number" />
      <div class="clear" />
    </div>
    <div class="form-row">
      <label class="form-label" for="latitude">Latitude</label>
      <input class="form-input" id="latitude" value="<%= event.location.latitude %>" type="number" />
      <div class="clear" />
    </div>
    <div class="form-row">
      <label class="form-label" for="ordered">Ordered</label>
      <% if (event.ordered) { %>
        <input class="form-input" id="ordered" type="checkbox" checked />
      <% } %>
      <% if (!event.ordered) { %>
        <input class="form-input" id="ordered" type="checkbox" />
      <% } %>
      <div class="clear" />
    </div>
    <h3>Organizer</h3>
    <div class="form-row">
      <label class="form-label" for="organizer_id">Organizer ID</label>
      <select class="form-input" id="organizer_id">
        <% if (users && users.length) { %>
          <% users.forEach(function(user){ %>
            <% if (user._id == event.organizer) { %>
              <option value="<%= user._id %>" selected><%= user.name %></option>
            <% } %>
            <% if (user._id != event.organizer) { %>
              <option value="<%= user._id %>"><%= user.name %></option>
            <% } %>
          <% }) %>
        <% } %>
      </select>
      <div class="clear" />
    </div>
    <div class="form-row">
      <label class="form-label" for="type">Type</label>
      <select class="form-input" id="type" disabled>
        <option value="Event" selected>Event</option>
        <option value="Checkpoint">Checkpoint</option>
        <option value="User">User</option>
        <option value="Enrollment">Enrollment</option>
        <option value="Checkin">Checkin</option>
      </select>
      <div class="clear" />
    </div>

    <div class="form-button-area">
      <button id="delete-button" type="button">Delete</button>
      <button id="submit-button" type="button">Save</button>
      <button id="cancel-button" type="button">Cancel</button>
    </div>
  </form>
  <script>
    var back = function() { window.location='./'; }
    var backback = function() { window.location='../'; }
    var parseForm = function(form) {
      var item = {};
      item.title = document.getElementById('title').value;
      item.description = document.getElementById('description').value;
      item.startTime = document.getElementById('startTime').value;
      item.endTime = document.getElementById('endTime').value;
      item.location = {};
      item.location.longitude = document.getElementById('longitude').value;
      item.location.latitude = document.getElementById('latitude').value; 
      item.ordered = document.getElementById('ordered').checked;
      item.organizer = document.getElementById('organizer_id').value;
      return item;
    };
    var submit = function(form, data, callback) {
      $.ajax({
        type: "PUT",
        url: form.action,
        data: data
      }).done(callback);
    };
    var deleteItem = function(form, callback) {
      $.ajax({
        type: "DELETE",
        url: form.action,
      }).done(callback);
    };
    $('#delete-button').bind('click', function() { 
      var form = document.getElementById('edit-form');
      deleteItem(form, backback); 
    });
    $('#cancel-button').bind('click', back);
    $('#submit-button').bind('click', function() { 
      var form = document.getElementById('edit-form');
      var data = parseForm(form);
      submit(form, data, back); 
    });
  </script>
</body>
</html>